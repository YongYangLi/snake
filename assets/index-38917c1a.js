(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const e of s.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&o(e)}).observe(document,{childList:!0,subtree:!0});function h(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=h(t);fetch(t.href,s)}})();var u=(a=>(a[a.UP=0]="UP",a[a.DOWN=1]="DOWN",a[a.LEFT=2]="LEFT",a[a.RIGHT=3]="RIGHT",a))(u||{});class m{get head(){return this.segments[0]}constructor(n,h,o){this.size=n,this.segments=h,this.direction=o}turnUpward(){[0,1].includes(this.direction)||(this.direction=0)}turnDownward(){[0,1].includes(this.direction)||(this.direction=1)}turnLeft(){[2,3].includes(this.direction)||(this.direction=2)}turnRight(){[2,3].includes(this.direction)||(this.direction=3)}update(n,h=!1){const{head:o,direction:t,segments:s}=this;let{x:e,y:i}=o;switch(t){case 0:i-=1;break;case 1:i+=1;break;case 2:e-=1;break;case 3:e+=1;break}if(h)e<0&&(e=this.size-1),e>=this.size&&(e=0),i<0&&(i=this.size-1),i>=this.size&&(i=0);else if(e<0||e>=this.size||i<0||i>=this.size)return!0;return n.x===e&&n.y===i||this.segments.pop(),!!(s.some(r=>r.x===e&&r.y===i)||(this.segments.unshift({x:e,y:i}),this.segments.length===this.size**2))}}const x=25;class b{constructor(n,h){this._handleRestartClick=o=>{console.log("点击事件触发，坐标:",o.clientX,o.clientY);const t=180,s=50,e=(this.size*x-t)/2,i=(this.size*x-s)/2+40,r=this.canvas.getBoundingClientRect(),c=o.clientX-r.left,l=o.clientY-r.top;if(c>=e&&c<=e+t&&l>=i&&l<=i+s){console.log("点击在重新开始按钮区域内"),this.canvas.removeEventListener("click",this._handleRestartClick);const d=this.game;d&&typeof d.resetGame=="function"?(console.log("调用game.resetGame()"),d.resetGame()):console.warn("game实例不存在或resetGame方法不可用")}else console.log("点击在按钮区域外")},this._convertCoord=o=>[o.x*x+x/2,o.y*x+x/2],this.container=n,this.size=h,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.style.width=this.size*x+200+"px",this.canvas.style.height=this.size*x+"px",this.canvas.width=this.size*x+200,this.canvas.height=this.size*x,this.container.appendChild(this.canvas),this.game=null}setGame(n){this.game=n}drawGrid(){for(let n=0;n<this.size;n++)for(let h=0;h<this.size;h++){const o=(n+h)%2===0?"rgb(171, 213, 90)":"rgb(163, 207, 83)";this.context.fillStyle=o,this.context.beginPath(),this.context.rect(n*x,h*x,x,x),this.context.closePath(),this.context.fill()}}drawApple(n){const[h,o]=this._convertCoord(n);this.context.save(),this.context.shadowColor="rgba(50, 50, 50, .2)",this.context.shadowBlur=10,this.context.beginPath(),this.context.arc(h,o,8,0,Math.PI*2),this.context.fillStyle="#f5222d",this.context.fill(),this.context.restore()}drawSnake(n,h=0){const{segments:o,head:t,direction:s}=n,e=new Path2D;if(o.forEach((d,g)=>{const[p,f]=this._convertCoord(d);g===0?e.moveTo(p,f):e.lineTo(p,f)}),this.context.save(),this.context.shadowColor="rgba(50, 50, 50, .2)",this.context.shadowBlur=10,this.context.lineCap="round",this.context.lineJoin="round",this.context.lineWidth=x*.8,h>0){const g=Date.now()%500/500,p=Math.sin(g*Math.PI*2)*.5+.5,w=(.3+h/5e3*.7)*(.7+p*.3);this.context.strokeStyle=`rgba(64, 169, 255, ${w})`}else this.context.strokeStyle="#40a9ff";this.context.stroke(e),this.context.restore();const[i,r]=this._convertCoord(t),c={x:0,y:0},l={x:0,y:0};switch(s){case u.UP:c.x=7,l.y=-2;break;case u.DOWN:c.x=7,l.y=2;break;case u.LEFT:c.y=7,l.x=-2;break;case u.RIGHT:c.y=7,l.x=2;break}this.context.save(),this.context.beginPath(),this.context.arc(i-c.x,r-c.y,5,0,Math.PI*2),this.context.closePath(),this.context.arc(i+c.x,r+c.y,5,0,Math.PI*2),this.context.closePath(),this.context.lineWidth=4,this.context.strokeStyle="#40a9ff",this.context.fillStyle="#fff",this.context.stroke(),this.context.fill(),this.context.beginPath(),this.context.arc(i-c.x+l.x,r-c.y+l.y,3,0,Math.PI*2),this.context.closePath(),this.context.arc(i+c.x+l.x,r+c.y+l.y,3,0,Math.PI*2),this.context.closePath(),this.context.fillStyle="#000",this.context.fill(),this.context.restore()}drawPowerUp(n){const[h,o]=this._convertCoord(n);switch(this.context.save(),this.context.shadowColor="rgba(50, 50, 50, .2)",this.context.shadowBlur=10,this.context.beginPath(),this.context.arc(h,o,8,0,Math.PI*2),n.type){case _.SPEED_UP:this.context.fillStyle="#52c41a";break;case _.SPEED_DOWN:this.context.fillStyle="#722ed1";break;case _.WALL_PASS:this.context.fillStyle="#faad14";break;case _.REVERSE_CONTROL:this.context.fillStyle="#eb2f96";break}this.context.fill(),this.context.beginPath();for(let t=0;t<5;t++){const s=t*4*Math.PI/5,e=t===0?8:4,i=h+e*Math.cos(s),r=o+e*Math.sin(s);t===0?this.context.moveTo(i,r):this.context.lineTo(i,r)}this.context.closePath(),this.context.strokeStyle="#fff",this.context.lineWidth=2,this.context.stroke(),this.context.restore()}drawGameOver(){this.context.font="bold 36px YaHei",this.context.fillStyle="red";const n=this.context.measureText("GAME OVER");this.context.fillText("GAME OVER",(this.size*x-n.width)/2,(this.canvas.height-48)/2-40);const h=180,o=50,t=(this.size*x-h)/2,s=(this.size*x-o)/2+40;this.context.save(),this.context.shadowColor="rgba(0, 0, 0, 0.2)",this.context.shadowBlur=10,this.context.shadowOffsetY=4;const e=this.context.createLinearGradient(t,s,t,s+o);e.addColorStop(0,"#40a9ff"),e.addColorStop(1,"#1890ff"),this.context.fillStyle=e,this.context.beginPath(),this.context.roundRect(t,s,h,o,12),this.context.fill(),this.context.restore(),this.context.save(),this.context.font="bold 20px YaHei",this.context.fillStyle="white",this.context.shadowColor="rgba(0, 0, 0, 0.3)",this.context.shadowBlur=2;const i="重新开始",r=this.context.measureText(i);this.context.fillText(i,t+(h-r.width)/2,s+o/2+8),this.context.restore(),this.canvas.addEventListener("click",this._handleRestartClick)}drawInfoPanel(n,h,o){var p;const t=this.size*x+10,s=180,e=15;this.context.save(),this.context.font='12px "Microsoft YaHei"',this.context.fillStyle="rgba(255, 255, 255, 0.7)",this.context.textAlign="right",this.context.fillText(`FPS: ${o!==void 0?o:Math.round(((p=this.game)==null?void 0:p.fps)||0)}`,this.size*x-10,20),this.context.restore(),this.context.save(),this.context.fillStyle="rgba(255, 255, 255, 0.95)",this.context.shadowColor="#434343",this.context.shadowBlur=20,this.context.shadowOffsetX=-2,this.context.beginPath(),this.context.roundRect(t,0,s,this.canvas.height,16),this.context.fill(),this.context.fillStyle="rgba(255, 255, 255, 0.08)",this.context.shadowColor="rgba(255, 255, 255, 0.15)",this.context.shadowBlur=12,this.context.shadowOffsetX=1,this.context.shadowOffsetY=1,this.context.roundRect(t+2,2,s-4,this.canvas.height-4,14),this.context.fill(),this.context.restore(),this.context.save();const i=30,r=this.context.createLinearGradient(t+e-10,i-15,t+e-10,i+75);r.addColorStop(0,"rgba(64, 169, 255, 0.12)"),r.addColorStop(1,"rgba(64, 169, 255, 0.05)"),this.context.fillStyle=r,this.context.shadowColor="rgba(0, 0, 0, 0.08)",this.context.shadowBlur=8,this.context.shadowOffsetY=2,this.context.beginPath(),this.context.roundRect(t+e-10,i-15,s-e*2+10,90,12),this.context.fill(),this.context.font='16px "Microsoft YaHei"',this.context.fillStyle="#333",this.context.fillText("当前得分",t+e,i+10),this.context.font='bold 32px "Microsoft YaHei"';const c=this.context.createLinearGradient(t+e,i+45-32,t+e+80,i+45);c.addColorStop(0,"#40a9ff"),c.addColorStop(1,"#1890ff"),this.context.fillStyle=c,this.context.fillText(n.toString(),t+e,i+45),this.context.font='14px "Microsoft YaHei"',this.context.fillStyle="#666",this.context.fillText("最高分: "+h,t+e,i+65),this.context.restore(),this.context.save(),this.context.font='bold 26px "Microsoft YaHei"',this.context.fillStyle="#111",this.context.fillText("游戏规则",t+e,150),this.context.restore();let l=190;const d=34;this.context.font='14px "Microsoft YaHei"',[{color:"#f5222d",text:"普通食物：增加长度",type:"circle"},{color:"#52c41a",text:"加速",type:"star"},{color:"#722ed1",text:"减速",type:"star"},{color:"#faad14",text:"穿墙",type:"star"},{color:"#eb2f96",text:"反向控制",type:"star"}].forEach((f,y)=>{this.context.save();const w=this.context.createRadialGradient(t+e,l+6,0,t+e,l+6,8);w.addColorStop(0,f.color),w.addColorStop(1,this._adjustColor(f.color,-20)),this.context.fillStyle=w,this.context.shadowColor="rgba(0, 0, 0, 0.2)",this.context.shadowBlur=8,this.context.beginPath(),this.context.arc(t+e,l+6,8,0,Math.PI*2),this.context.fill(),f.type==="star"&&(this.context.strokeStyle="rgba(255, 255, 255, 0.9)",this.context.lineWidth=2,this.drawStar(t+e,l+6,6)),this.context.shadowBlur=0,this.context.fillStyle="#444",this.context.fillText(f.text,t+e+24,l+10),this.context.restore(),l+=d}),l+=8,this.context.save(),this.context.fillStyle="#444",this.context.font='bold 15px "Microsoft YaHei"',this.context.fillText("操作说明",t+e,l),this.context.font='14px "Microsoft YaHei"',this.context.fillText("使用方向键控制蛇的移动",t+e,l+d-8),this.context.restore()}drawStar(n,h,o){this.context.beginPath();for(let t=0;t<5;t++){const s=t*4*Math.PI/5,e=t===0?o:o/2,i=n+e*Math.cos(s),r=h+e*Math.sin(s);t===0?this.context.moveTo(i,r):this.context.lineTo(i,r)}this.context.closePath(),this.context.fill(),this.context.strokeStyle="rgba(255, 255, 255, 0.9)",this.context.lineWidth=1.5,this.context.stroke()}_adjustColor(n,h){const o=n.replace("#",""),t=parseInt(o,16),s=Math.min(255,Math.max(0,(t>>16)+h)),e=Math.min(255,Math.max(0,(t>>8&255)+h)),i=Math.min(255,Math.max(0,(t&255)+h));return`#${(s<<16|e<<8|i).toString(16).padStart(6,"0")}`}}const S=21;var _=(a=>(a[a.SPEED_UP=0]="SPEED_UP",a[a.SPEED_DOWN=1]="SPEED_DOWN",a[a.WALL_PASS=2]="WALL_PASS",a[a.REVERSE_CONTROL=3]="REVERSE_CONTROL",a))(_||{});class k{constructor(n,h=S){this._apple={x:0,y:0},this._powerUp=null,this._start=!1,this._speed=200,this._wallPass=!1,this._reverseControl=!1,this._powerUpTimeout=null,this._powerUpStartTime=null,this._score=0,this._highScore=0,this._powerUpCount=0,this._lastFrameTime=0,this._frameCount=0,this._fps=0,this._lastFpsUpdate=Date.now(),this._getAvailableCoords=()=>{const{segments:t}=this.snake;return new Array(this.size**2).fill(0).map((s,e)=>({x:e%this.size,y:Math.floor(e/this.size)})).filter(s=>t.every(({x:e,y:i})=>s.x!==e||s.y!==i)&&(this._powerUp===null||s.x!==this._powerUp.x||s.y!==this._powerUp.y)&&(s.x!==this._apple.x||s.y!==this._apple.y))},this._placeApple=()=>{const t=this._getAvailableCoords();if(t.length===0)return;const s=Math.floor(t.length*Math.random());this._apple=t[s]},this._placePowerUp=()=>{if(this._powerUp!==null)return;const t=this._getAvailableCoords();if(t.length===0)return;const s=Math.floor(t.length*Math.random()),e=t[s],i=Object.values(_).filter(c=>typeof c=="number"),r=i[Math.floor(Math.random()*i.length)];this._powerUp={...e,type:r,duration:5e3}},this._applyPowerUp=t=>{switch(this._powerUpTimeout&&clearTimeout(this._powerUpTimeout),t.type){case 0:this._speed=100;break;case 1:this._speed=300;break;case 2:this._wallPass=!0;break;case 3:this._reverseControl=!0;break}clearInterval(this._timer),this._timer=setInterval(this._update,this._speed),this._powerUpStartTime=Date.now(),this._powerUpTimeout=setTimeout(()=>{this._speed=200,this._wallPass=!1,this._reverseControl=!1,this._powerUpStartTime=null,clearInterval(this._timer),this._timer=setInterval(this._update,this._speed)},t.duration)},this._update=()=>{if(this.snake.update(this._apple,this._wallPass)){clearInterval(this._timer),this._powerUpTimeout&&clearTimeout(this._powerUpTimeout),localStorage.setItem("snake_high_score",this._highScore.toString()),this.painter.drawGameOver();return}this._apple.x===this.snake.head.x&&this._apple.y===this.snake.head.y&&(this._placeApple(),Math.random()<.3&&!this._powerUp&&this._placePowerUp()),this._powerUp&&this._powerUp.x===this.snake.head.x&&this._powerUp.y===this.snake.head.y&&(this._applyPowerUp(this._powerUp),this._powerUp=null,this._powerUpCount++),this._score=(this.snake.segments.length-2)*10+this._powerUpCount*50,this._highScore=Math.max(this._score,this._highScore);const s=Date.now();s-this._lastFpsUpdate>1e3?(this._fps=this._frameCount,this._frameCount=0,this._lastFpsUpdate=s):this._frameCount++,this._lastFrameTime=s,this.painter.drawGrid(),this.painter.drawApple(this._apple),this._powerUp&&this.painter.drawPowerUp(this._powerUp),this.painter.drawSnake(this.snake,this.getPowerUpRemainingTime()),this.painter.drawInfoPanel(this._score,this._highScore,this._fps)},this._handleKeydown=t=>{if(this._start||(this._timer=setInterval(this._update,this._speed),this._start=!0),this._reverseControl)switch(t.key){case"ArrowUp":this.snake.turnDownward();break;case"ArrowDown":this.snake.turnUpward();break;case"ArrowLeft":this.snake.turnRight();break;case"ArrowRight":this.snake.turnLeft();break}else switch(t.key){case"ArrowUp":this.snake.turnUpward();break;case"ArrowDown":this.snake.turnDownward();break;case"ArrowLeft":this.snake.turnLeft();break;case"ArrowRight":this.snake.turnRight();break}},this.size=h;const o={x:Math.floor(this.size/2),y:Math.floor(this.size/2)};this.snake=new m(this.size,[o,{x:o.x,y:o.y+1},{x:o.x,y:o.y+2}],u.UP),this._score=0,this._highScore=parseInt(localStorage.getItem("snake_high_score")||"0"),this.painter=new b(n,h),this.painter.setGame(this),window.addEventListener("keydown",this._handleKeydown,!1),this._placeApple(),this.painter.drawGrid(),this.painter.drawApple(this._apple),this.painter.drawSnake(this.snake,0),this.painter.drawInfoPanel(0,this._highScore)}getPowerUpRemainingTime(){if(!this._powerUpStartTime||!this._powerUpTimeout)return 0;const n=Date.now()-this._powerUpStartTime;return Math.max(0,5e3-n)}resetGame(){clearInterval(this._timer),this._powerUpTimeout&&clearTimeout(this._powerUpTimeout);const n={x:Math.floor(this.size/2),y:Math.floor(this.size/2)};this.snake=new m(this.size,[n,{x:n.x,y:n.y+1}],u.UP),this._score=0,this._powerUpCount=0,this._powerUp=null,this._wallPass=!1,this._reverseControl=!1,this._speed=200,this._start=!1,this._timer=null,this._powerUpTimeout=null,this._placeApple(),this.painter.drawGrid(),this.painter.drawApple(this._apple),this.painter.drawSnake(this.snake,0),this.painter.drawInfoPanel(0,this._highScore)}}const P=document.getElementById("root");new k(P);
